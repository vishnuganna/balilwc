<template>
    <div class="slds-p-left_medium slds-p-right_medium slds-grid slds-gutters">
        <article class="slds-card slds-card_boundary  slds-m-bottom_large slds-size_1-of-1">
            <!--Create View<lightning-card class="slds-m-around_none slds-p-around_none">-->
            <div slot="title" class="slds-grid slds-card__header slds-grid_vertical-align-center cardheader-goldsheet">
                <div class="slds-col slds-size_2-of-3">
                    <span class="cardlabels-goldsheet"
                        >{label.vulnerablityTitle}
                        <c-info-navigation nav-url={label.criticalVulnerabilityHeaderUrl}></c-info-navigation>
                    </span>
                </div>

                <div class="slds-col slds-size_1-of-3 ">
                    <template if:true={showSavedState}>
                        <div class="slds-clearfix slds-float_right">
                            <template if:true={isDeletable}>
                                <lightning-button
                                    label={label.deleteLabel}
                                    title={label.deleteLabel}
                                    variant="base"
                                    class="slds-p-right_x-small"
                                    onclick={deleteVulnerability}
                                ></lightning-button>
                            </template>
                            <template if:true={isUpdatable}>
                                <lightning-button
                                    label={label.edit}
                                    title={label.edit}
                                    onclick={makeFormEditable}
                                ></lightning-button>
                            </template>
                        </div>
                    </template>
                </div>
            </div>

            <div class="slds-m-top_x-small slds-m-bottom_x-small" style="border-top: 1px solid #dcdcdc;">
                <!-- has no data -->
                <template if:false={hasAccess}>
                    <template if:false={showSavedState}>
                        <div class="slds-p-bottom_x-small">
                            <c-summary-view-no-data></c-summary-view-no-data>
                        </div>
                    </template>
                </template>

                <!-- saved state -->
                <template if:true={showSavedState}>
                    <div class="slds-grid slds-grid_vertical slds-m-around_medium ">
                        <div class="slds-col">
                            <div class="slds-grid">
                                <span><b>{criticalVulnerablityTitle}</b></span>
                                <span class="slds-col">
                                    <c-strength-redflag
                                        rfs-data={rfsDetails.vulnerablity}
                                        read-only-view="true"
                                    ></c-strength-redflag>
                                </span>
                            </div>
                        </div>

                        <div class="slds-col slds-size_2-of-3 slds-m-top_small">
                            <c-show-more-show-less-line description={criticalVulnerablityDesc} no-of-lines="3">
                            </c-show-more-show-less-line>
                        </div>
                    </div>
                </template>

                <!-- has edit access -->
                <template if:true={hasAccess}>
                    <!-- button to add critical Vulnerability -->
                    <template if:true={showCreateButton}>
                        <div class="slds-m-top_x-small">
                            <lightning-button
                                variant="brand"
                                label={label.addVulnerabilityButton}
                                class="slds-m-left_medium pointer"
                                onclick={addCriticalVulnerablity}
                            ></lightning-button>
                        </div>
                    </template>

                    <!-- new and edit state -->
                    <template if:true={isEditable}>
                        <div>
                            <div class="slds-grid slds-m-around_small">
                                <div class="slds-col slds-size_1-of-3">
                                    <label
                                        >{label.criticalDescTitleLabel}<abbr class="slds-required" title="required"
                                            >*</abbr
                                        >
                                        <c-strength-redflag
                                            rfs-data={rfsDetails.vulnerablity}
                                            class="slds-clearfix slds-float_right"
                                            onvalueselected={handleMarkerChange}
                                        ></c-strength-redflag>
                                    </label>

                                    <div>
                                        <lightning-input
                                            type="text"
                                            name="criticalTitle"
                                            label=""
                                            max-length="80"
                                            onchange={handleTitle}
                                            value={criticalVulnerablityTitle}
                                            style="font-size: small;"
                                        ></lightning-input>
                                    </div>
                                    <template if:true={showMaxLimitErrorTitle}
                                        ><div class="slds-text-color_error">
                                            {label.Trend_cannot_exceed_80_characters}
                                        </div></template
                                    >
                                </div>
                            </div>

                            <div class="slds-grid slds-m-around_medium">
                                <div class="slds-col slds-size_2-of-3">
                                    <lightning-textarea
                                        name="criticalDesc"
                                        label={label.criticalDescLabel}
                                        value={criticalVulnerablityDesc}
                                        class="slds-m-top_small textAreaPosition"
                                        max-length="32000"
                                        onchange={handleDesc}
                                        message-when-too-long="32K Charecters allowed"
                                        style="font-size: small;"
                                    ></lightning-textarea>

                                    <lightning-layout>
                                        <template if:true={showMaxLimitError}
                                            ><div class="slds-text-color_error">
                                                {label.Description_cannot_exceed_32k_characters}
                                            </div></template
                                        >
                                    </lightning-layout>
                                </div>
                            </div>

                            <div class="slds-m-around_medium item">
                                <div class="slds-align_absolute-center">
                                    <template if:true={cvShowSpinner}>
                                        <div class="spinner">
                                            <lightning-spinner
                                                alternative-text="Loading"
                                                size="small"
                                            ></lightning-spinner>
                                        </div>
                                    </template>
                                    <lightning-button
                                        label={label.cancelLabel}
                                        title="Non-primary action"
                                        class="slds-m-left_x-small"
                                        onclick={cancel}
                                    >
                                    </lightning-button>
                                    <lightning-button
                                        label={label.saveLabel}
                                        title="Non-primary action"
                                        class="slds-m-left_x-small"
                                        variant="brand"
                                        disabled={isButtonDisabled}
                                        onclick={handleSave}
                                    >
                                    </lightning-button>
                                </div>
                            </div>
                        </div>
                    </template>
                </template>
            </div>
            <!-- </lightning-card> -->
        </article>

        <!-- modal start -->
        <template if:true={ShowModal}>
            <c-prompt-modal
                header-label={label.DeleteVulnerabilityHeader}
                body-msg={label.deleteCompetitionMessage}
                positive-response-button={label.yes}
                negative-response-button={label.cancel}
                close-label="close"
                onpositiveresponse={deleteModal}
                onnegativeresponse={closeModal}
            ></c-prompt-modal>
        </template>
        <!-- modal end -->
    </div>
</template>